const Application = function() {
  this.tuner = new Tuner()
  this.notes = new Notes(this.tuner)
  this.meter = new Meter('.meter')
  this.update({ name: 'A', frequency: 440, octave: 4, value: 69, cents: 0 })
}

Application.prototype.start = function() {
  const self = this

  this.tuner.onNoteDetected = function(note) {
    if (self.lastNote === note.name) {
      self.update(note)
    } else {
      self.lastNote = note.name
    }
  }

  document.getElementById( 'switch' ).addEventListener('change', function() {
    if (this.checked) {
      self.tuner.init()
      self.frequencyData = new Uint8Array(self.tuner.analyser.frequencyBinCount)
    } else {
      console.log("Disabled");
    }
  });
  
  // swal.fire('Welcome online tuner!').then(function() {
  //   self.tuner.init()
  //   self.frequencyData = new Uint8Array(self.tuner.analyser.frequencyBinCount)
  // })

}

Application.prototype.update = function(note) {
  this.notes.update(note)
  // Output
  this.meter.update(note.cents, (note.cents / 50) * 45)
}

const patterns = {
  'C':[
    0,0,0,0,1,1,1,0,0,0,0,
    0,0,0,1,0,0,0,1,0,0,0,
    0,0,0,1,0,0,0,0,0,0,0,
    0,0,0,1,0,0,0,0,0,0,0,
    0,0,0,1,0,0,0,0,0,0,0,
    0,0,0,1,0,0,0,1,0,0,0,
    0,0,0,0,1,1,1,0,0,0,0
  ],
  'C#':[
    0,1,1,1,0,0,0,1,0,1,0,
    1,0,0,0,1,0,1,1,1,1,1,
    1,0,0,0,0,0,0,1,0,1,0,
    1,0,0,0,0,0,1,1,1,1,1,
    1,0,0,0,0,0,0,1,0,1,0,
    1,0,0,0,1,0,0,0,0,0,0,
    0,1,1,1,0,0,0,0,0,0,0,
  ],
  'D':[
    0,0,0,1,1,1,1,0,0,0,0,
    0,0,0,1,0,0,0,1,0,0,0,
    0,0,0,1,0,0,0,1,0,0,0,
    0,0,0,1,0,0,0,1,0,0,0,
    0,0,0,1,0,0,0,1,0,0,0,
    0,0,0,1,0,0,0,1,0,0,0,
    0,0,0,1,1,1,1,0,0,0,0
  ],
  'D#':[
    1,1,1,1,0,0,0,1,0,1,0,
    1,0,0,0,1,0,1,1,1,1,1,
    1,0,0,0,1,0,0,1,0,1,0,
    1,0,0,0,1,0,1,1,1,1,1,
    1,0,0,0,1,0,0,1,0,1,0,
    1,0,0,0,1,0,0,0,0,0,0,
    1,1,1,1,0,0,0,0,0,0,0,
  ],
  'E':[
    0,0,0,1,1,1,1,1,0,0,0,
    0,0,0,1,0,0,0,0,0,0,0,
    0,0,0,1,0,0,0,0,0,0,0,
    0,0,0,1,1,1,1,0,0,0,0,
    0,0,0,1,0,0,0,0,0,0,0,
    0,0,0,1,0,0,0,0,0,0,0,
    0,0,0,1,1,1,1,1,0,0,0
  ],
  'F':[
    0,0,0,1,1,1,1,1,0,0,0,
    0,0,0,1,0,0,0,0,0,0,0,
    0,0,0,1,0,0,0,0,0,0,0,
    0,0,0,1,1,1,1,0,0,0,0,
    0,0,0,1,0,0,0,0,0,0,0,
    0,0,0,1,0,0,0,0,0,0,0,
    0,0,0,1,0,0,0,0,0,0,0
  ],
  'F#':[
    1,1,1,1,1,0,0,1,0,1,0,
    1,0,0,0,0,0,1,1,1,1,1,
    1,0,0,0,0,0,0,1,0,1,0,
    1,1,1,1,0,0,1,1,1,1,1,
    1,0,0,0,0,0,0,1,0,1,0,
    1,0,0,0,0,0,0,0,0,0,0,
    1,0,0,0,0,0,0,0,0,0,0,
  ],
  'G':[
    0,0,0,0,1,1,1,0,0,0,0,
    0,0,0,1,0,0,0,0,0,0,0,
    0,0,0,1,0,0,0,0,0,0,0,
    0,0,0,1,0,1,1,1,0,0,0,
    0,0,0,1,0,0,0,1,0,0,0,
    0,0,0,1,0,0,0,1,0,0,0,
    0,0,0,0,1,1,1,0,0,0,0
  ],
  'G#':[
    0,1,1,1,0,0,0,1,0,1,0,
    1,0,0,0,0,0,1,1,1,1,1,
    1,0,0,0,0,0,0,1,0,1,0,
    1,0,1,1,1,0,1,1,1,1,1,
    1,0,0,0,1,0,0,1,0,1,0,
    1,0,0,0,1,0,0,0,0,0,0,
    0,1,1,1,0,0,0,0,0,0,0,
  ],
  'A':[
    0,0,0,0,1,1,1,0,0,0,0,
    0,0,0,1,0,0,0,1,0,0,0,
    0,0,0,1,0,0,0,1,0,0,0,
    0,0,0,1,1,1,1,1,0,0,0,
    0,0,0,1,0,0,0,1,0,0,0,
    0,0,0,1,0,0,0,1,0,0,0,
    0,0,0,1,0,0,0,1,0,0,0
  ],
  'A#':[
    0,1,1,1,0,0,0,1,0,1,0,
    1,0,0,0,1,0,1,1,1,1,1,
    1,0,0,0,1,0,0,1,0,1,0,
    1,1,1,1,1,0,1,1,1,1,1,
    1,0,0,0,1,0,0,1,0,1,0,
    1,0,0,0,1,0,0,0,0,0,0,
    1,0,0,0,1,0,0,0,0,0,0,
  ],
  'B':[
    0,0,0,1,1,1,1,0,0,0,0,
    0,0,0,1,0,0,0,1,0,0,0,
    0,0,0,1,0,0,0,1,0,0,0,
    0,0,0,1,1,1,1,0,0,0,0,
    0,0,0,1,0,0,0,1,0,0,0,
    0,0,0,1,0,0,0,1,0,0,0,
    0,0,0,1,1,1,1,0,0,0,0
  ]
}

const app = new Application()
app.start()